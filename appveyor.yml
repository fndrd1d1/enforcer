install:
  - ps: Start-FileDownload 'https://static.rust-lang.org/dist/rust-beta-i686-pc-windows-gnu.exe'
  - rust-beta-i686-pc-windows-gnu.exe /VERYSILENT /NORESTART /DIR="C:\Program Files (x86)\Rust"
  - SET PATH=%PATH%;C:\Program Files (x86)\Rust\bin
  - rustc -V
  - cargo -V

build: none

test_script:
  - cargo build --release
  - cmd: 7z a enforcer$(appveyor_build_version).zip target/release/enforcer.exe
  - cargo test --verbose

artifacts:
  - path: enforcer$(appveyor_build_version).zip
    name: Enforcer

deploy:
  release: enforcer$(appveyor_build_version)
  description: 'windows build'
  provider: GitHub
  auth_token:
    secure: N4GrYfvlyx33sighQh9einBAFVoiXAnIhvIEfoj75UH+MH5sFNvp49BNF+ysN+Dw
  artifact: enforcer$(appveyor_build_version).zip
  draft: false
  prerelease: false
  on:
    branch: master                 # release from master branch only
    appveyor_repo_tag: true        # deploy on tag push only
